这次我们继续来聊滴滴滴 鲤鱼虚动设计鲤鱼虚动 什么鬼 听得对头大溜了溜了别急着滑走 你先听个一分钟常常先保证老少皆一同所无期好 那我们抓紧时间 直接上项目每个项目就看三秒钟 一秒也不浪费来 一 二 三 结束 看到了什么一堆service和文件夹 项目是干啥的好 再看这个 一 二 三 结束是不是稍微有点感觉了大概能拆到这个项目是有三个功能模块都是些什么来着giann service看起来像是一个同用服务hissure request大概率是这种管理历史请求的sysmanage看起来像是一个系统管理这大概是个提供什么 同用服务的管理系统这就是滴滴滴想要告诉你最重要的事情就是主动让技术去靠近业务业务怎么设计 技术就怎么实现这就是滴滴滴 说得再直白一点就是让程序员可以直接和业务专家聊天搞清楚你到底要做的是什么而不是悶头鼓挡那些别人看不懂的controller service DAO好了 一分钟到了如果你觉得还是莫名其妙那么麻烦留下个点赞然后下个视频更精彩留下来的朋友 请坐好 咱们要上硬菜了都说滴滴滴是领域去动设计那什么是领域呢其实刚才想要让你一眼就看懂的gen service his request这些我们就管它叫领域Domain其实哪怕我们不管程序我们天天也在说领域java领域 篮球领域短视频也可以使个领域什么都可以使领域那所谓领域其实就是一条业务边界而滴滴叫做第一件事就是给系统划分领域比如我们聊淘宝是什么你不会说它是一堆代码吧你会说它是一个购物网站有商品搜索 下单交易用户商务馆 野定单物流这些相对独立的业务能力这些业务都有自己独特的业务规则他们之间都有一些不太明显的逻辑边界他们就是一个个独立的领域你会说这不就是按业务划分吗但滴滴滴中的领域也没那么简单业务边界口头一说就行今天可以这么说 明天可以这么说但项目最终是要落在代码中的呀领域的边界就不能这么耳系了首先要保证开发交易领域的程序员不会一不小心把物流领域给改动了怎么解决这个问题呢滴滴滴跑出来的核武器线界上下文bounded context这个东西可以说就是滴滴滴真正的核心这和业务花分有什么区别呢你可以把这些领域想象成一个独立的王国交易是一个王国 物流是另一个每个王国里都有自己的通用语言有自己的法律也就是我的业务规则也有自己的政府 也就是我的应用服务每个王国在自己的边界内绝对自知而通过线界上下文花分出来的一个个完整的软件单元在它自己的边界里也要实现绝对的自知这其实也是为什么你一眼就能大概拆除一个系统是干什么的原因要保持一个王国独立除了有内部资质 还有有外部合作比如交易王国完成了订单要通知物流王国发货怎么办呢靠外交在软件世界里这就是API调用交易上下文要用物流上下文的API说嘿 订单一二三付钱了你该干活了这就够了物流内部怎么实现的交易完全不关心也无权去关心这个线界上下文就相当于是一个王国在地域上和业务上的国界线它用铁腕手段保证领域的绝对独立有没有感觉格局一下打开了平底区可以扣个一接下来我们重新往国内部看看内部应该怎么去治理一个独立王国怎么实现的其实核心就是要解决两个问题第一 在王国的内部代码怎么写才不会乱第二 在王国之间怎么防止被隔壁老王的瞎改搞得鸡犬不灵滴滴滴其实早就想好了靠的是内政和外交内政用四层架构理清内部对内我们用四层架构来划分部门职责接口成国家的外交部负责跟外面打交道应用成国家的办公厅负责协调各部门完成一个任务领域层国家的心脏所有核心业务规则都在这基础设施层 后勤部负责连接数据库 发消息等着些脏活儿内活这套架构的核心其实就是依赖道志心脏作为领域层绝不能依赖后勤也就是基础设施层后勤可以随便换但心脏必须闻死不动强力保证内部的稳定和灵活关于这个事成家构之前其实做过详细的推演这里就不展开了外交用防抚层来捍卫主权内部管理好了对外我们最怕的就是隔壁老王天天改APN如果每次隔壁有个风吹草动我们都要跟着改代那所谓的独立不就算了笑话了吗为了捍卫主权滴滴滴在现届上线文章中也留了一个口子叫做防抚层这是什么呢它就是我们派出去的专门跟隔壁老王打击道的翻译官这个翻译官是我们自己人住扎在我们自己的地盘当中我们要用外部接口的时候只需要跟自己的翻译官说话由他负责把我们说的话翻译成对方能听懂的格式如果对方的接口变了我们只需要让翻译官去学习新的外语就行了我们王国新藏内部的核心业务根本不知道外面发生了什么这个防抚层就像一道防火墙完美的把外部世界的变化和腐烂隔离在了往国界之内然后在之前的分享当中也介绍了在java中可以用接口的形式来实现防抚层说到接口恰好现在火热的微服架构声明远端服务也选了接口不管是double还是open fame都是这样的为什么会这么巧合呢你没有觉得哥登一下像捅破一层窗户纸了其实这也不算是巧合DDD的提出时间比现在人静接受的微服更早了十几年但直到微服在各种开源框架的支撑下逐步成熟稳定下来DDD才开始再次被人们提及现在业界总能听到说DDD落地很难的说法好像它只是架构实手里的玩具但其实只要你把思路打开DDD落地或许并没有想象中那么难请你回想一下当你的交易为服务需要用物流为服务时你是不是会在交易为服务里定一个清晰的API接口然后通过double或者fan这样的技术框架给这个接口实现具体的业务在这个过程当中实际上就已经完成了DDD中线界上下文落地最核心的几个要素第一 隔离这个接口属于你的交易为服务它将交易的内部逻辑和物流的外部实现之间完美的隔离开了第二 翻译你在这个接口的背后自然而然就会将你内部的数据格式变成外部接口需要的格式这就是翻译第三 节偶在微服体系中无论是double还是sbring的open fame调用远端服务你都只需要什么一个接口就可以了作为客户端你不需要知道服务端是怎么实现这个服务的而在jama体系中如果你以接口的形式去落地DD中的各种防腐层那么微服体系天神就已经为DDD铺平了项目落地的道路你所定义的那些专门用来和外部系统打交道的接口它就可以是我们苦苦追寻的防腐层只不过在整个DD的体系当中更强调设计背后的道而不是具体实现的数对于防腐层定义的各种接口你可以选择微服这种远程的接口实现也可以是单体架构中本地的接口实现这都没关系甚至如果你对我们之前分析的DD仕层架构真的有过落地的尝试你会发现在DD的视角下所谓单体架构和分布层的微服架构其实是一样的都只是通过接口找实现而已你要做的只是需要换个视角重新理解这些你天天在用的微服的各种框架所以别再觉得DD遥不可及了你一手中的微服那套技术站像Spring, Necklace, Double, MQ这些都是DDD最好的实现工具如果有我的老学员就知道我曾经分享过一个很简单的DDD项目在所谓单体架构和微服架构之间切换只需要调整一个Spring的注解就可以了当然,这只是一个短视频就没法再展开了讲到这里你可能会觉得微服和DDD简直是天作之合它俩本来就差不多对吧但事实是这样嘛微服这个概念最早是有Martin Foley这位大神体处的但与此同时他在介绍微服架构时反复的强调了一个原则Malolith First单体优先这就有点意思了咱们现在写个Demo都恨不得上微服了那为什么微服的创始主先反而让我们先从单体架构开始呢这背后又隐藏的内结果关于架构眼睛的深重智慧呢想多明白这个反直觉建议背后的真相吗评论区留下你的想法点赞关注下一期我就带你一起探索这位主持人留下的架构中级迷提